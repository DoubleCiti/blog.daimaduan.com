Title: 管理一个网站
Date: 2015-12-20 16:14
Slug: maange-a-webiste
Authors: David Xie

很多人感觉开发一个网站, 就是写写代码, 然后部署上去就ok了. 比如说这个人会`ruby on rails`, 那么他能很快的制作出一个管理todo list的网站, 然后购买heroku的服务部署上去, 这一切看上去都那么美好. 结果呢? 过了2个小时后, 他的网站如果由于代码错误而不能访问超过了1个星期, 而他自己一点都不知道.

### 那么, 写一个网站, 或者说管理一个网站, 都需要注意哪些地方呢?

1. Issue管理

    这个issue可以是网站要开发的下一个功能, 可以是目前发现的一个bug, 也可以是用户提的一个需求.

    很多企业在实施agile的时候, 都会选择jira. 如果你的网站是一个开源项目的话, 或者代码托管在`github`或者`bitbucket`这样的网站的话, 那么它们提供的issues管理, 就是已经是一个很好的选择了.

    另外可选的工具有`Trello`, `Teambition`或者`Tower.im`

2. 可用性检查

    每个人都希望自己的网站可以24小时的运行, 同时不出任何问题, 但是总会有一些难以预料的事情发生. 那么我们就需要一个服务, 可以定时的检查我们的网站, 发生问题后及时的通知我们.

    有很多工具可以提供这样的服务, 比如说`pingdom`, `gomez`, `NewRelic`. 这里推荐一个服务叫`updown.io`, 是一个免费的服务, 可以每分钟访问一下你的网站, 出现问题可以邮件通知, 如果愿意付费的话, 还可以选择短信通知. 同时, 它也可以和slack集成.

3. 性能检查

    在我们给网站加了越来越多的功能之后, 程序肯定会变得越来越慢, 那么一个好的性能分析工具, 可以让你很快的发现问题. 这里最好的选择是`NewRelic`.

4. 日志聚合

    不管是我们的程序, 还是我们用的服务器, 都会生成很多的日志. 如果同时我们再有很多的服务器, 那么管理这些日志将会非常的困难, 排查问题也会变得更加困难.

    目前比较流行的做法是使用`logstash`这样的工具, 将日志全部集中在一个地方, 然后建立各种查询条件来分析日志并发现问题.

    `Splunk`号称是地球上最好的日志聚合工具, 但是售价不菲, 所以不是土豪的话, 一般还是选择便宜或者开源的工具.

5. 访问分析

    任何一个网站都是需要用户访问, 那么用户访问后, 我们怎么能够知道用户的访问情况呢? 答案是使用访问分析工具.

    市面上有很多这样的工具, 比较流行的有Google的`Analytics`和Adobe的`omniture`.

6. 失败方案

    没有一个网站可以说自己是365天, 24小时都没有任何问题的, 那么出现问题后, 除了通知网站管理员来修复外, 网站还应该有一个失败方案能够让不中断用户的访问, 或者至少友好的告诉用户, 网站出了问题, 请稍后访问.

    比较常见的办法是failover到另一台机器, 由那台机器来暂时提供服务, 直到管理员修复问题后再切换回来.

7. 备份方案

    就像失败的例子一样, 网站的数据也有可能出现问题, 导致数据的丢失或者不一致. 那么比较稳妥的解决或者是预防办法是每天都做一次备份.

    最简单的方法就是`cron`来制定一个任务, 每天凌晨将数据库里的数据进行备份. 不管你用的是数据库是`MySQL`, `PostgreSQL`或者`MongoDB`, 他们都有`dump`的工具能够让你将数据备份出来, 同时也提供了`restore`的工具, 出现问题后可以恢复之前的备份.

### 这里列一下代码段使用的工具:

* Issues管理我们用的是`Github`的`Issues`
* 可用性检查用的是`updown.io`
* 性能检查是`NewRelic`
* 访问分析是`Google Analytics`
* 日志聚合用的是免费版的`Splunk`
